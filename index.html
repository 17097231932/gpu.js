<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Slow Fade</title>
</head>
<body>
  <h1>Slow Fade</h1>
  <div>
    <canvas id="c"></canvas>
  </div>
</body>
<script src="./dist/gpu-browser.js"></script>
<script>
  const canvas = document.getElementById('c');
  const gpu = new GPU({
    canvas: canvas,
    mode: 'gpu'
  });
  const dim = 512;
  const kernel = gpu.createKernel(
    function(x) {
      this.color(
        (x * (this.thread.y + this.thread.x)) / 1024,
        (x * (this.thread.y * this.thread.x)) / (1024 * 1024),
        (x * (this.thread.y * 2 * this.thread.x)) / (1024 * 2),
        1
      );
    },
    {
      useLegacyEncoder: true,
      output: [dim, dim],
      graphical: true
    }
  );

  let param = 0;
  const doDraw = () => {
    kernel(param);
    param += 0.001;
    window.requestAnimationFrame(doDraw);
  };

  window.requestAnimationFrame(doDraw);
</script>
<script>
    const gpu1 = new GPU();
function kernelFunction(degrees, divisors) {
    const bounds = subKernel(this.constants.rotation * degrees);
    return [bounds[0] / divisors[0], bounds[1] / divisors[1]];
}
function subKernel(value) {
    return [-value, value];
}
const kernelMap = gpu1.createKernelMap({
    test: subKernel,
}, kernelFunction)
    .setConstants({
    rotation: 45,
})
    .setOutput([1])
    .setPrecision('single')
    .setPipeline(true)
    .setImmutable(true);
const { test, result } = kernelMap(360, [256, 512]);
const testTexture = test;
const resultTexture = result;
console.log(testTexture.toArray());
console.log(resultTexture.toArray());
testTexture.delete();
resultTexture.delete();
kernelMap.destroy();

</script>
</html>
